<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Kode Editor - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        
        body {
            background-color: #09090b;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
            color: #e2e8f0;
        }

        .s23-chassis {
            width: 360px;
            height: 760px;
            background: black;
            border-radius: 44px;
            border: 8px solid #27272a;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        .punch-hole {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 18px;
            background: #18181b;
            border-radius: 50%;
            z-index: 50;
            border: 1px solid #27272a;
        }

        .code-input {
            font-family: 'Fira Code', monospace;
            background: transparent;
            color: #93c5fd;
            resize: none;
            outline: none;
            border: none;
            width: 100%;
            height: 100%;
            font-size: 11px;
            line-height: 1.6;
        }

        .active-tab {
            border-bottom: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            color: white;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="s23-chassis ring-2 ring-zinc-700">
        <div class="punch-hole"></div>

        <!-- Status Bar -->
        <div class="h-10 w-full flex items-center justify-between px-8 pt-3 text-[11px] font-bold text-zinc-400 z-40">
            <span id="clock">12:00</span>
            <div class="flex items-center gap-2">
                <i data-lucide="wifi" class="w-3 h-3"></i>
                <i data-lucide="battery" class="w-3 h-3"></i>
            </div>
        </div>

        <!-- Header -->
        <header class="flex items-center justify-between px-5 py-3 bg-zinc-900 border-b border-zinc-800">
            <div class="flex items-center gap-2">
                <div class="p-1.5 bg-blue-600 rounded-lg">
                    <i data-lucide="layers" class="w-4 h-4 text-white"></i>
                </div>
                <div class="flex flex-col">
                    <span class="text-[10px] font-black uppercase tracking-tighter text-white">Android Kode Editor</span>
                    <span id="current-project" class="text-[8px] text-zinc-500 uppercase">FS: System-Root</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="previewBuild()" class="p-2 bg-blue-500 text-white rounded-full active:scale-90 transition-all">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                </button>
                <button onclick="runCurrentFile()" class="p-2 bg-green-500 text-black rounded-full active:scale-90 transition-all">
                    <i data-lucide="play" class="w-4 h-4 fill-current"></i>
                </button>
            </div>
        </header>

        <!-- Tabs Bar -->
        <div id="tabs-bar" class="flex bg-zinc-900 border-b border-zinc-800 overflow-x-auto no-scrollbar"></div>

        <!-- Workspace -->
        <main id="workspace" class="flex-1 overflow-hidden relative bg-zinc-950 flex flex-col">
            
            <!-- Explorer View -->
            <div id="view-explorer" class="hidden flex-1 flex flex-col bg-zinc-900/50 p-4 overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Filstruktur</h3>
                    <div class="flex gap-2">
                        <button onclick="createNewFile()" class="p-1 hover:text-blue-400"><i data-lucide="file-plus" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <div id="file-tree" class="space-y-1"></div>
            </div>

            <!-- Editor View -->
            <div id="view-editor" class="flex-1 flex overflow-hidden">
                <div id="line-numbers" class="w-8 bg-zinc-900/30 border-r border-zinc-800 flex flex-col items-center pt-4 text-[9px] text-zinc-600 font-mono select-none"></div>
                <textarea id="editor" class="code-input p-4" spellcheck="false" placeholder="// Velg en fil..."></textarea>
            </div>

            <!-- Preview View (For HTML/CSS Build) -->
            <div id="view-preview" class="hidden flex-1 bg-white">
                <iframe id="preview-frame" class="w-full h-full border-none"></iframe>
            </div>

            <!-- Terminal View -->
            <div id="view-terminal" class="hidden flex-1 bg-black p-5 overflow-y-auto font-mono text-[10px]">
                <div id="terminal-output" class="text-emerald-500"></div>
            </div>

            <!-- Library View -->
            <div id="view-library" class="hidden flex-1 p-5 space-y-6 overflow-y-auto">
                <section>
                    <h3 class="text-[10px] font-bold text-blue-400 uppercase mb-3 flex items-center gap-2">
                        <i data-lucide="package" class="w-3 h-3"></i> Requirements.txt
                    </h3>
                    <div class="bg-zinc-900 rounded-xl p-3 border border-zinc-800">
                        <p class="text-[8px] text-zinc-500 mb-2 italic">Installer pakker definert i filen</p>
                        <button onclick="installFromRequirements()" class="w-full bg-blue-600/20 text-blue-400 text-[9px] font-bold py-2 rounded border border-blue-500/30 uppercase">Build Dependencies</button>
                    </div>
                </section>

                <section>
                    <h3 class="text-[10px] font-bold text-orange-400 uppercase mb-3 flex items-center gap-2">
                        <i data-lucide="cpu" class="w-3 h-3"></i> JS Modul Manager
                    </h3>
                    <div class="bg-zinc-900 rounded-xl p-3 border border-zinc-800 space-y-2">
                        <select id="module-selector" class="w-full bg-black border border-zinc-800 rounded p-2 text-[10px] text-white outline-none">
                            <option value="react">React (ESM)</option>
                            <option value="vue">Vue 3 (ESM)</option>
                            <option value="three">Three.js</option>
                        </select>
                        <button onclick="importModuleSnippet()" class="w-full bg-zinc-800 text-[9px] font-bold py-2 rounded uppercase">Sett inn Import</button>
                    </div>
                </section>
            </div>
        </main>

        <!-- Navigation -->
        <nav class="h-20 grid grid-cols-4 bg-zinc-900 border-t border-zinc-800 px-2 pb-4">
            <button onclick="switchTab('explorer')" id="btn-explorer" class="flex flex-col items-center justify-center gap-1 text-zinc-600">
                <i data-lucide="folder-tree" class="w-5 h-5"></i>
                <span class="text-[8px] font-black uppercase">Filer</span>
            </button>
            <button onclick="switchTab('editor')" id="btn-editor" class="flex flex-col items-center justify-center gap-1 text-blue-500">
                <i data-lucide="code-2" class="w-5 h-5"></i>
                <span class="text-[8px] font-black uppercase">Editor</span>
            </button>
            <button onclick="switchTab('terminal')" id="btn-terminal" class="flex flex-col items-center justify-center gap-1 text-zinc-600">
                <i data-lucide="terminal" class="w-5 h-5"></i>
                <span class="text-[8px] font-black uppercase">Logg</span>
            </button>
            <button onclick="switchTab('library')" id="btn-library" class="flex flex-col items-center justify-center gap-1 text-zinc-600">
                <i data-lucide="box" class="w-5 h-5"></i>
                <span class="text-[8px] font-black uppercase">Lib</span>
            </button>
        </nav>

        <div class="h-1.5 w-24 bg-zinc-800 mx-auto mb-2 rounded-full"></div>
    </div>

    <script>
        // Filstruktur som støtter moduler og requirements
        let files = JSON.parse(localStorage.getItem('fs_pro')) || [
            { id: '1', name: 'index.html', content: '<!DOCTYPE html>\n<html>\n<head>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">Laster...</div>\n  <script type="module" src="main.js"><' + '/script>\n</body>\n</html>', type: 'file' },
            { id: '2', name: 'style.css', content: 'body { background: #09090b; color: #3b82f6; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }', type: 'file' },
            { id: '3', name: 'main.js', content: 'import { render } from "./ui.js";\nrender("Hallo fra moduler!");', type: 'file' },
            { id: '4', name: 'ui.js', content: 'export function render(text) {\n  document.getElementById("app").innerHTML = `<h1>${text}</h1>`;\n}', type: 'file' },
            { id: '5', name: 'requirements.txt', content: 'tailwindcss\nlucide\nreact', type: 'file' }
        ];

        let activeFileId = '1';
        let openTabs = ['1'];

        lucide.createIcons();

        function updateClock() {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateClock, 1000); updateClock();

        function renderFileTree() {
            const tree = document.getElementById('file-tree');
            tree.innerHTML = '';
            files.forEach(f => {
                const div = document.createElement('div');
                div.className = `file-item flex items-center justify-between p-2 rounded text-[11px] cursor-pointer ${activeFileId === f.id ? 'text-blue-400 bg-blue-500/5' : 'text-zinc-400'}`;
                const icon = f.name.endsWith('.html') ? 'layout' : f.name.endsWith('.css') ? 'palette' : f.name.endsWith('.txt') ? 'file-text' : 'file-code';
                div.innerHTML = `<div onclick="openFile('${f.id}')" class="flex items-center gap-2"><i data-lucide="${icon}" class="w-3 h-3"></i> ${f.name}</div>`;
                tree.appendChild(div);
            });
            lucide.createIcons();
        }

        function renderTabs() {
            const bar = document.getElementById('tabs-bar');
            bar.innerHTML = '';
            openTabs.forEach(id => {
                const f = files.find(x => x.id === id);
                if (!f) return;
                const tab = document.createElement('div');
                tab.className = `flex items-center gap-2 px-4 py-2 text-[10px] border-r border-zinc-800 cursor-pointer ${activeFileId === id ? 'active-tab' : 'text-zinc-500'}`;
                tab.innerHTML = `${f.name} <span onclick="closeTab('${id}', event)">×</span>`;
                tab.onclick = () => openFile(id);
                bar.appendChild(tab);
            });
        }

        function openFile(id) {
            const f = files.find(x => x.id === id);
            if (!f) return;
            activeFileId = id;
            if (!openTabs.includes(id)) openTabs.push(id);
            document.getElementById('editor').value = f.content;
            switchTab('editor');
            renderFileTree();
            renderTabs();
            updateLineNumbers();
        }

        function closeTab(id, e) {
            e.stopPropagation();
            openTabs = openTabs.filter(t => t !== id);
            if (activeFileId === id) activeFileId = openTabs[0] || null;
            renderTabs();
            if (activeFileId) openFile(activeFileId);
        }

        function switchTab(view) {
            ['explorer', 'editor', 'terminal', 'library', 'preview'].forEach(v => {
                const el = document.getElementById('view-' + v);
                if(el) el.classList.add('hidden');
                const btn = document.getElementById('btn-' + v);
                if(btn) btn.classList.replace('text-blue-500', 'text-zinc-600');
            });
            document.getElementById('view-' + view).classList.remove('hidden');
            const activeBtn = document.getElementById('btn-' + view);
            if(activeBtn) activeBtn.classList.replace('text-zinc-600', 'text-blue-500');
        }

        function updateLineNumbers() {
            const lines = document.getElementById('editor').value.split('\n').length;
            const container = document.getElementById('line-numbers');
            container.innerHTML = '';
            for(let i=1; i<=Math.max(lines, 30); i++) {
                const s = document.createElement('span');
                s.className = 'h-[17.6px]';
                s.innerText = i;
                container.appendChild(s);
            }
        }

        // Build system som simulerer import/eksport
        function previewBuild() {
            const htmlFile = files.find(f => f.name === 'index.html');
            const cssFile = files.find(f => f.name === 'style.css');
            
            // Vi simulerer et virtuelt filsystem i iframe
            let bundledJS = "";
            files.filter(f => f.name.endsWith('.js')).forEach(f => {
                // Gjør "import/export" kompatibelt med en enkelt bundle for demo
                let content = f.content
                    .replace(/import { (.*) } from ".\/(.*).js";/g, '/* Local Import: $2 */')
                    .replace(/export function (.*)\(/g, 'function $1(');
                bundledJS += `\n/* File: ${f.name} */\n${content}\n`;
            });

            let fullContent = htmlFile.content
                .replace('<link rel="stylesheet" href="style.css">', `<style>${cssFile.content}</style>`)
                .replace(/<script type="module" src="main.js"><\/script>/, `<script>${bundledJS}<\/script>`);

            const frame = document.getElementById('preview-frame');
            frame.srcdoc = fullContent;
            switchTab('preview');
        }

        function installFromRequirements() {
            const req = files.find(f => f.name === 'requirements.txt');
            if(!req) return alert("Opprett requirements.txt først!");
            
            switchTab('terminal');
            const libs = req.content.split('\n').filter(l => l.trim());
            logToTerminal("System: Starter build-sekvens...", 'system');
            libs.forEach((lib, i) => {
                setTimeout(() => {
                    logToTerminal(`Pip: Installerer ${lib.trim()}...`, 'log');
                    if(i === libs.length - 1) logToTerminal("Build: Fullført!", "system");
                }, (i + 1) * 700);
            });
        }

        function importModuleSnippet() {
            const mod = document.getElementById('module-selector').value;
            const snippets = {
                react: 'import React from "https://esm.sh/react@18";',
                vue: 'import { createApp } from "https://esm.sh/vue@3";',
                three: 'import * as THREE from "https://esm.sh/three";'
            };
            const editor = document.getElementById('editor');
            editor.value = snippets[mod] + "\n" + editor.value;
            logToTerminal(`Modul: La til import for ${mod}`, 'system');
        }

        function logToTerminal(msg, type = 'log') {
            const out = document.getElementById('terminal-output');
            const div = document.createElement('div');
            div.className = `mb-1 ${type === 'error' ? 'text-red-400' : (type === 'system' ? 'text-blue-400' : '')}`;
            div.innerText = `> ${msg}`;
            out.appendChild(div);
            document.getElementById('view-terminal').scrollTop = out.scrollHeight;
        }

        document.getElementById('editor').addEventListener('input', (e) => {
            const f = files.find(x => x.id === activeFileId);
            if(f) f.content = e.target.value;
            localStorage.setItem('fs_pro', JSON.stringify(files));
            updateLineNumbers();
        });

        renderFileTree();
        renderTabs();
        openFile('1');
    </script>
</body>
</html>
