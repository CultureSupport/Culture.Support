<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevStudio Pro - Web & AI Designer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap');
        
        :root {
            --ai-glow: 0 0 20px rgba(167, 139, 250, 0.3);
            --editor-bg: #0d1117;
        }

        body {
            background-color: #010409;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: ui-sans-serif, system-ui, sans-serif;
            color: #c9d1d9;
        }

        .phone-frame {
            width: 390px;
            height: 844px;
            background: #000;
            border-radius: 50px;
            border: 10px solid #21262d;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
        }

        .editor-font {
            font-family: 'Fira Code', monospace;
        }

        .tab-active {
            background: #161b22;
            border-top: 2px solid #a78bfa;
            color: #f0f6fc;
        }

        /* Web Preview Styling */
        #web-preview-container {
            background: white;
            width: 100%;
            height: 100%;
            border: none;
        }

        .ai-pulse-ring {
            animation: ring-pulse 2s infinite;
        }

        @keyframes ring-pulse {
            0% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(167, 139, 250, 0); }
            100% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0); }
        }
    </style>
</head>
<body>

    <div class="phone-frame">
        <!-- System Bar -->
        <div class="h-12 w-full flex items-center justify-between px-8 pt-4">
            <span id="clock" class="text-xs font-bold text-slate-400">--:--</span>
            <div class="flex items-center gap-2">
                <i data-lucide="wifi" class="w-3 h-3 text-slate-500"></i>
                <i data-lucide="battery-full" class="w-3 h-3 text-emerald-500"></i>
            </div>
        </div>

        <!-- App Header -->
        <header class="px-6 py-4 bg-[#161b22] border-b border-[#30363d] flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg ai-pulse-ring">
                    <i data-lucide="layout" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h1 class="text-[11px] font-black text-white uppercase tracking-widest">Web Studio AI</h1>
                    <span class="text-[8px] text-purple-400 font-bold uppercase">Gemini Web Engine</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="togglePreview()" id="preview-toggle-btn" class="p-2 bg-emerald-500/10 text-emerald-400 rounded-lg border border-emerald-500/20">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div id="tabs" class="flex bg-[#0d1117] border-b border-[#30363d] overflow-x-auto no-scrollbar"></div>

        <main class="flex-1 relative flex flex-col overflow-hidden bg-[#0d1117]">
            
            <!-- Views -->
            <div id="view-explorer" class="hidden flex-1 p-6 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Prosjekt</h3>
                    <div class="flex gap-3">
                        <button onclick="createItem('file')" class="text-blue-400"><i data-lucide="file-plus" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div id="file-tree" class="space-y-1"></div>
            </div>

            <div id="view-editor" class="flex-1 flex flex-col overflow-hidden">
                <div class="flex-1 flex overflow-hidden">
                    <div id="line-numbers" class="w-10 bg-[#010409] text-right pr-2 pt-4 text-[9px] text-[#484f58] editor-font select-none"></div>
                    <textarea id="editor" class="flex-1 bg-transparent p-4 editor-font text-xs text-[#c9d1d9] outline-none resize-none leading-relaxed" spellcheck="false" oninput="onEditorInput()"></textarea>
                </div>
            </div>

            <div id="view-preview" class="hidden flex-1 bg-white overflow-hidden">
                <iframe id="web-preview-container"></iframe>
            </div>

            <!-- Terminal -->
            <div id="terminal" class="h-48 bg-black border-t border-[#30363d] flex flex-col">
                <div class="flex items-center justify-between px-4 py-2 bg-[#161b22] text-[9px] font-bold text-slate-400">
                    <span>WEB CONSOLE</span>
                    <i data-lucide="chevron-down" class="w-4 h-4 cursor-pointer" onclick="toggleTerminal()"></i>
                </div>
                <div id="term-body" class="flex-1 overflow-y-auto p-4 editor-font text-[10px] space-y-1">
                    <div class="text-blue-400">Klar til å bygge HTML/CSS/JS med Gemini...</div>
                </div>
                <div class="flex items-center px-4 py-3 bg-[#0d1117]">
                    <span class="text-purple-500 font-bold mr-2">AI ></span>
                    <input id="term-input" type="text" class="flex-1 bg-transparent outline-none text-[10px] text-white" placeholder="Be AI om å lage en nettside..." onkeydown="handleCommand(event)">
                </div>
            </div>

            <!-- Global AI Button -->
            <button onclick="aiWebDesign()" class="absolute bottom-20 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center shadow-xl z-50">
                <i data-lucide="palette" class="w-7 h-7 text-white"></i>
            </button>
        </main>

        <!-- Navigation -->
        <nav class="h-20 bg-[#161b22] border-t border-[#30363d] flex items-center justify-around px-4 pb-6">
            <button onclick="navigate('explorer')" id="nav-explorer" class="flex flex-col items-center gap-1 text-slate-500">
                <i data-lucide="folder" class="w-5 h-5"></i>
                <span class="text-[8px] font-bold uppercase">Filer</span>
            </button>
            <button onclick="navigate('editor')" id="nav-editor" class="flex flex-col items-center gap-1 text-purple-400">
                <i data-lucide="code" class="w-5 h-5"></i>
                <span class="text-[8px] font-bold uppercase">Kode</span>
            </button>
            <button onclick="navigate('preview')" id="nav-preview" class="flex flex-col items-center gap-1 text-slate-500">
                <i data-lucide="globe" class="w-5 h-5"></i>
                <span class="text-[8px] font-bold uppercase">Web</span>
            </button>
        </nav>
    </div>

    <script>
        const apiKey = "";
        const STORAGE_ID = 'gemini_web_studio_v2';

        let state = JSON.parse(localStorage.getItem(STORAGE_ID)) || {
            fs: [
                { id: '1', name: 'index.html', type: 'file', parent: null, content: '<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { font-family: sans-serif; text-align: center; background: #f0f4f8; }\n    .hero { padding: 50px; }\n  </style>\n</head>\n<body>\n  <div class="hero">\n    <h1>Velkommen til AI Web Studio</h1>\n    <p>Be Gemini om å endre dette designet!</p>\n  </div>\n</body>\n</html>' }
            ],
            active: '1',
            tabs: ['1'],
            isPreviewMode: false
        };

        function save() { localStorage.setItem(STORAGE_ID, JSON.stringify(state)); }

        async function askAI(promptText) {
            const currentFile = state.fs.find(f => f.id === state.active);
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Du er en ekspert på webutvikling (HTML5, CSS3, JS). Brukeren ønsker: ${promptText}. Gjeldende kode:\n${currentFile.content}\n\nReturner KUN den komplette oppdaterte koden for denne filen.` }] }]
                    })
                });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text.replace(/```[a-z]*\n/g, '').replace(/```/g, '').trim();
            } catch (e) { return null; }
        }

        async function aiWebDesign() {
            const task = prompt("Hva vil du at Gemini skal lage? (f.eks: 'Lag en moderne mørk landingsside med Tailwind')", "Lag en interaktiv navigasjonsmeny");
            if (!task) return;

            logToTerminal(`Gemini designer...`, 'text-purple-400');
            const result = await askAI(task);
            if (result) {
                const file = state.fs.find(f => f.id === state.active);
                file.content = result;
                document.getElementById('editor').value = result;
                updatePreview();
                logToTerminal(`Design oppdatert!`, 'text-emerald-400');
                save();
            }
        }

        async function handleCommand(e) {
            if (e.key === 'Enter') {
                const val = e.target.value.trim();
                if (!val) return;
                logToTerminal(`AI > ${val}`, 'text-slate-500');
                const result = await askAI(val);
                if (result) {
                    const file = state.fs.find(f => f.id === state.active);
                    file.content = result;
                    document.getElementById('editor').value = result;
                    updatePreview();
                }
                e.target.value = '';
            }
        }

        function updatePreview() {
            const html = state.fs.find(f => f.name === 'index.html')?.content || '';
            const iframe = document.getElementById('web-preview-container');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            doc.open();
            doc.write(html);
            doc.close();
        }

        function togglePreview() {
            state.isPreviewMode = !state.isPreviewMode;
            navigate(state.isPreviewMode ? 'preview' : 'editor');
            if (state.isPreviewMode) updatePreview();
        }

        function logToTerminal(msg, color = 'text-white') {
            const body = document.getElementById('term-body');
            const div = document.createElement('div');
            div.className = color;
            div.innerText = msg;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        }

        function renderTree() {
            const root = document.getElementById('file-tree');
            root.innerHTML = '';
            state.fs.forEach(item => {
                const div = document.createElement('div');
                div.className = `flex items-center gap-2 p-2 rounded-lg text-[11px] ${state.active === item.id ? 'bg-[#161b22] text-white' : 'text-slate-400'}`;
                div.innerHTML = `<i data-lucide="file-code" class="w-4 h-4 text-blue-400"></i><span>${item.name}</span>`;
                div.onclick = () => { state.active = item.id; renderTree(); renderTabs(); document.getElementById('editor').value = item.content; };
                root.appendChild(div);
            });
            lucide.createIcons();
        }

        function navigate(view) {
            ['explorer', 'editor', 'preview'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                document.getElementById(`nav-${v}`).classList.replace('text-purple-400', 'text-slate-500');
            });
            document.getElementById(`view-${view}`).classList.remove('hidden');
            document.getElementById(`nav-${view}`).classList.replace('text-slate-500', 'text-purple-400');
            if(view === 'preview') updatePreview();
        }

        function renderTabs() {
            const container = document.getElementById('tabs');
            container.innerHTML = '';
            state.tabs.forEach(id => {
                const file = state.fs.find(f => f.id === id);
                const tab = document.createElement('div');
                tab.className = `px-4 py-2 text-[10px] whitespace-nowrap cursor-pointer ${state.active === id ? 'tab-active' : 'text-slate-500'}`;
                tab.innerText = file.name;
                container.appendChild(tab);
            });
        }

        function onEditorInput() {
            const file = state.fs.find(f => f.id === state.active);
            file.content = document.getElementById('editor').value;
            save();
            if(state.isPreviewMode) updatePreview();
        }

        window.onload = () => {
            document.getElementById('editor').value = state.fs.find(f => f.id === state.active).content;
            renderTree();
            renderTabs();
            setInterval(() => {
                document.getElementById('clock').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }, 1000);
            lucide.createIcons();
        };
    </script>
</body>
</html>
