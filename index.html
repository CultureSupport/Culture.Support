<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevStudio Pro - Web & AI Designer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@300;400;700;900&display=swap');
        
        :root {
            --ai-glow: 0 0 20px rgba(167, 139, 250, 0.3);
            --editor-bg: #0d1117;
        }

        body {
            background-color: #010409;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            color: #c9d1d9;
        }

        .phone-frame {
            width: 390px;
            height: 844px;
            background: #000;
            border-radius: 50px;
            border: 10px solid #21262d;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
        }

        .editor-font {
            font-family: 'Fira Code', monospace;
        }

        .tab-active {
            background: #161b22;
            border-top: 2px solid #a78bfa;
            color: #f0f6fc;
        }

        #web-preview-container {
            background: white;
            width: 100%;
            height: 100%;
            border: none;
        }

        .ai-pulse-ring {
            animation: ring-pulse 2s infinite;
        }

        @keyframes ring-pulse {
            0% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(167, 139, 250, 0); }
            100% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0); }
        }

        /* Loading Overlay */
        #ai-loading {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="phone-frame">
        <div id="ai-loading">
            <div class="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-xs font-bold text-white uppercase tracking-widest">Gemini genererer...</p>
        </div>

        <!-- System Bar -->
        <div class="h-12 w-full flex items-center justify-between px-8 pt-4">
            <span id="clock" class="text-xs font-bold text-slate-400">--:--</span>
            <div class="flex items-center gap-2">
                <i data-lucide="wifi" class="w-3 h-3 text-slate-500"></i>
                <i data-lucide="battery-full" class="w-3 h-3 text-emerald-500"></i>
            </div>
        </div>

        <!-- App Header -->
        <header class="px-6 py-4 bg-[#161b22] border-b border-[#30363d] flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-gradient-to-br from-indigo-500 to-purple-700 rounded-xl flex items-center justify-center shadow-lg ai-pulse-ring">
                    <i data-lucide="zap" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h1 class="text-[11px] font-black text-white uppercase tracking-widest leading-none mb-1">Turbo Designer</h1>
                    <span class="text-[8px] text-purple-400 font-bold uppercase tracking-tighter">AI Fast-Track Mode</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="togglePreview()" id="preview-toggle-btn" class="p-2 bg-indigo-500/10 text-indigo-400 rounded-lg border border-indigo-500/20 active:scale-90 transition-transform">
                    <i data-lucide="play" class="w-4 h-4"></i>
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div id="tabs" class="flex bg-[#0d1117] border-b border-[#30363d] overflow-x-auto no-scrollbar"></div>

        <main class="flex-1 relative flex flex-col overflow-hidden bg-[#0d1117]">
            
            <div id="view-explorer" class="hidden flex-1 p-6 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Prosjektstruktur</h3>
                    <button onclick="createItem('file')" class="text-indigo-400"><i data-lucide="plus-circle" class="w-5 h-5"></i></button>
                </div>
                <div id="file-tree" class="space-y-1"></div>
            </div>

            <div id="view-editor" class="flex-1 flex flex-col overflow-hidden">
                <div class="flex-1 flex overflow-hidden">
                    <div id="line-numbers" class="w-10 bg-[#010409] text-right pr-2 pt-4 text-[9px] text-[#484f58] editor-font select-none"></div>
                    <textarea id="editor" class="flex-1 bg-transparent p-4 editor-font text-xs text-[#c9d1d9] outline-none resize-none leading-relaxed" spellcheck="false" oninput="onEditorInput()"></textarea>
                </div>
            </div>

            <div id="view-preview" class="hidden flex-1 bg-white overflow-hidden">
                <iframe id="web-preview-container"></iframe>
            </div>

            <!-- AI Quick Actions Bar -->
            <div class="px-4 py-2 bg-[#161b22] border-t border-[#30363d] flex gap-2 overflow-x-auto no-scrollbar">
                <button onclick="aiTurboBuild('landing')" class="px-3 py-1.5 bg-indigo-600 rounded-md text-[9px] font-bold text-white whitespace-nowrap">LANDING PAGE</button>
                <button onclick="aiTurboBuild('portfolio')" class="px-3 py-1.5 bg-purple-600 rounded-md text-[9px] font-bold text-white whitespace-nowrap">PORTFOLIO</button>
                <button onclick="aiTurboBuild('ecommerce')" class="px-3 py-1.5 bg-pink-600 rounded-md text-[9px] font-bold text-white whitespace-nowrap">WEBSHOP</button>
            </div>

            <!-- Terminal -->
            <div id="terminal" class="h-40 bg-black border-t border-[#30363d] flex flex-col">
                <div id="term-body" class="flex-1 overflow-y-auto p-4 editor-font text-[10px] space-y-1">
                    <div class="text-indigo-400 font-bold">Turbo Engine v3.0 Klar.</div>
                    <div class="text-slate-500 italic">Be AI lage en full side på 10 sekunder...</div>
                </div>
                <div class="flex items-center px-4 py-3 bg-[#0d1117] border-t border-zinc-900">
                    <span class="text-purple-500 font-bold mr-2 text-xs">⚡</span>
                    <input id="term-input" type="text" class="flex-1 bg-transparent outline-none text-[10px] text-white" placeholder="Beskriv nettsiden her..." onkeydown="handleCommand(event)">
                </div>
            </div>
        </main>

        <!-- Navigation -->
        <nav class="h-20 bg-[#161b22] border-t border-[#30363d] flex items-center justify-around px-4 pb-6">
            <button onclick="navigate('explorer')" id="nav-explorer" class="flex flex-col items-center gap-1 text-slate-500">
                <i data-lucide="layers" class="w-5 h-5"></i>
                <span class="text-[8px] font-bold uppercase">Prosjekt</span>
            </button>
            <button onclick="navigate('editor')" id="nav-editor" class="flex flex-col items-center gap-1 text-indigo-400">
                <i data-lucide="terminal" class="w-5 h-5"></i>
                <span class="text-[8px] font-bold uppercase">Editor</span>
            </button>
            <button onclick="navigate('preview')" id="nav-preview" class="flex flex-col items-center gap-1 text-slate-500">
                <i data-lucide="monitor" class="w-5 h-5"></i>
                <span class="text-[8px] font-bold uppercase">Preview</span>
            </button>
        </nav>
    </div>

    <script>
        const apiKey = "AIzaSyDZHh0e18le3EOfP1ELHyf9B94smft2lEg";
        const STORAGE_ID = 'gemini_turbo_web_v3';

        let state = JSON.parse(localStorage.getItem(STORAGE_ID)) || {
            fs: [{ id: '1', name: 'index.html', type: 'file', content: '<!DOCTYPE html>\n<html>\n<body class="bg-gray-100 flex items-center justify-center h-screen font-sans">\n  <div class="text-center">\n    <h1 class="text-4xl font-black text-indigo-600">DevStudio Turbo</h1>\n    <p class="text-gray-500 mt-2">Klar for AI-generering!</p>\n  </div>\n</body>\n</html>' }],
            active: '1',
            tabs: ['1']
        };

        function save() { localStorage.setItem(STORAGE_ID, JSON.stringify(state)); }

        async function aiTurboBuild(type) {
            const prompts = {
                landing: "Lag en moderne, high-end landing page for en AI-startup. Bruk Tailwind CSS, inkluder en hero-seksjon med glassmorphism, features-seksjon med ikoner, og en mørk footer. Legg til en 'Back to top' knapp med JS.",
                portfolio: "Lag en minimalistisk portefølje-nettside for en designer. Bruk et grid-system for prosjekter, inkluder en 'om meg' seksjon, og en kontakt-form. Bruk elegante fonter fra Google Fonts.",
                ecommerce: "Lag en moderne nettbutikk-forside for klær. Inkluder en sticky navbar, et stort banner-bilde, produkt-kort med hover-effekter, og en handlevogn-modal i JavaScript."
            };
            const prompt = prompts[type] || type;
            await processAIRequest(prompt);
        }

        async function processAIRequest(promptText) {
            const loading = document.getElementById('ai-loading');
            loading.style.display = 'flex';
            logToTerminal(`Initialiserer Turbo Build for: ${promptText.substring(0, 20)}...`, 'text-indigo-400');

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `DU ER EN MASTER WEB DEVELOPER. Din oppgave: ${promptText}. 
                        REGLER:
                        1. Returner KUN den komplette HTML-koden (inkludert inline CSS/JS eller Tailwind CDN).
                        2. Ingen forklaringer.
                        3. Koden skal være klar til bruk umiddelbart.
                        4. Sørg for at designet er responsivt og fungerer på mobil.` }] }]
                    })
                });
                const data = await res.json();
                const code = data.candidates[0].content.parts[0].text.replace(/```[a-z]*\n/g, '').replace(/```/g, '').trim();
                
                const file = state.fs.find(f => f.id === state.active);
                file.content = code;
                document.getElementById('editor').value = code;
                updatePreview();
                logToTerminal(`Full nettside generert på under 10 sekunder!`, 'text-emerald-400');
                save();
            } catch (e) {
                logToTerminal(`Feil under generering. Prøv igjen.`, 'text-red-400');
            } finally {
                loading.style.display = 'none';
            }
        }

        async function handleCommand(e) {
            if (e.key === 'Enter') {
                const val = e.target.value.trim();
                if (!val) return;
                e.target.value = '';
                await processAIRequest(val);
            }
        }

        function updatePreview() {
            const html = state.fs.find(f => f.name === 'index.html')?.content || '';
            const iframe = document.getElementById('web-preview-container');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            doc.open();
            doc.write(html);
            doc.close();
        }

        function togglePreview() {
            const current = document.getElementById('view-preview').classList.contains('hidden');
            navigate(current ? 'preview' : 'editor');
        }

        function navigate(view) {
            ['explorer', 'editor', 'preview'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                document.getElementById(`nav-${v}`).classList.replace('text-indigo-400', 'text-slate-500');
            });
            document.getElementById(`view-${view}`).classList.remove('hidden');
            document.getElementById(`nav-${view}`).classList.replace('text-slate-500', 'text-indigo-400');
            if(view === 'preview') updatePreview();
        }

        function logToTerminal(msg, color = 'text-white') {
            const body = document.getElementById('term-body');
            const div = document.createElement('div');
            div.className = `${color} leading-tight`;
            div.innerText = `> ${msg}`;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        }

        function renderTree() {
            const root = document.getElementById('file-tree');
            root.innerHTML = '';
            state.fs.forEach(item => {
                const div = document.createElement('div');
                div.className = `flex items-center gap-2 p-2 rounded-lg text-[11px] ${state.active === item.id ? 'bg-[#161b22] text-white' : 'text-slate-400'}`;
                div.innerHTML = `<i data-lucide="file-text" class="w-4 h-4 text-indigo-400"></i><span>${item.name}</span>`;
                root.appendChild(div);
            });
            lucide.createIcons();
        }

        function onEditorInput() {
            const file = state.fs.find(f => f.id === state.active);
            file.content = document.getElementById('editor').value;
            save();
        }

        window.onload = () => {
            document.getElementById('editor').value = state.fs.find(f => f.id === state.active).content;
            renderTree();
            setInterval(() => {
                document.getElementById('clock').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }, 1000);
            lucide.createIcons();
        };
    </script>
</body>
</html>
